<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Happy Birthday Wiffyy ‚ù§Ô∏è</title>
<style>
  :root{
    --bg1:#fff0f7; --bg2:#fff8fb;
    --accent:#ff5fae; --card:#ffffffee;
    --btn-shadow: 0 8px 24px rgba(255,105,165,0.14);
  }

  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial; -webkit-font-smoothing:antialiased;}
  body{
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    padding:16px; box-sizing:border-box; display:flex; justify-content:center;
  }

  .wrap{width:100%;max-width:520px}
  .card{
    background:var(--card); border-radius:16px; padding:14px; box-shadow:0 12px 36px rgba(230,120,170,0.08);
  }

  header{display:flex;gap:12px;align-items:center}
  .avatar{width:56px;height:56px;border-radius:50%;background:linear-gradient(180deg,#ffd1ea,#ffb3df);display:flex;align-items:center;justify-content:center;font-weight:700;color:#4b0029;font-size:20px;box-shadow:0 6px 18px rgba(255,120,175,0.12)}
  h1{margin:0;font-size:18px;color:#c4166f}
  .lead{margin:2px 0 0;color:#6d123f;font-size:13px}

  .hero{margin-top:12px;text-align:center}
  .title{font-size:26px;margin:6px 0;color:transparent;background:linear-gradient(90deg,#ff69b4,#ffb3e6);-webkit-background-clip:text;font-weight:800}
  .sub{color:#7a1b4b;margin-top:6px;font-size:13px}

  .photo-wrap{position:relative;margin:14px auto 8px;width:92%;max-width:380px}
  .photo{width:100%;height:auto;border-radius:14px;display:block;box-shadow:0 16px 40px rgba(255,120,170,0.12);outline:6px solid rgba(255,255,255,0.6);object-fit:cover}
  .glow{
    position:absolute;inset:-14px;border-radius:18px;pointer-events:none;
    background: radial-gradient(circle at 50% 40%, rgba(255,140,200,0.24), rgba(255,160,210,0.06) 30%, transparent 60%);
    filter: blur(20px); opacity:var(--glow-opacity,0.85); transform:scale(var(--glow-scale,1));
    transition: opacity .12s linear, transform .08s linear;
  }

  .card-body{padding:6px 2px 2px}
  .msg{font-size:14px;color:#4a133b;line-height:1.5;margin:8px 6px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  .btn{background:linear-gradient(180deg,#ff9ad6,#ff7ec2);border:none;padding:11px 14px;border-radius:12px;color:#fff;font-weight:700;box-shadow:var(--btn-shadow);font-size:14px}
  .btn:active{transform:translateY(1px)}

  footer{text-align:center;color:#b42458;margin-top:12px;font-size:13px}

  /* music button: fixed, high z-index */
  #musicBtn {
    --size:58px;
    position:fixed;
    right:14px;
    bottom:14px;
    width:var(--size);
    height:var(--size);
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:99999;
    background:linear-gradient(180deg,#ff6fb4,#ff3f8a);
    color:white;
    font-size:22px;
    box-shadow:0 12px 36px rgba(255,80,150,0.22);
    border:4px solid rgba(255,255,255,0.12);
    touch-action:manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Smaller screens: scale down music button */
  @media (max-width:420px){
    #musicBtn {
      --size:46px;
      width:var(--size);
      height:var(--size);
      right:10px;
      bottom:10px;
      font-size:18px;
    }
  }

  @media (max-width:360px){
    #musicBtn {
      --size:40px;
      width:var(--size);
      height:var(--size);
      right:8px;
      bottom:8px;
      font-size:16px;
    }
  }

  #musicBtn.playing{ box-shadow:0 16px 48px rgba(255,80,150,0.28); }

  /* popup: mobile safe */
  #popup{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:99998;
    background:linear-gradient(180deg, rgba(6,4,12,0.45), rgba(4,4,12,0.75)); padding:12px; box-sizing:border-box;
  }
  .popup-inner{
    width:100%; max-width:360px; background:linear-gradient(180deg,#fff,#fffafc); border-radius:14px; padding:12px; box-sizing:border-box;
    box-shadow:0 20px 60px rgba(8,6,20,0.6); text-align:center;
  }
  .popup-inner img{width:100%;height:auto;border-radius:10px;margin-bottom:10px;object-fit:cover}
  .popup-text{color:#c41b6a;font-size:15px;line-height:1.4;margin-bottom:10px}
  .popup-close{width:100%;padding:10px;border-radius:12px;border:none;background:#ff5fae;color:white;font-weight:700;font-size:15px}

  /* falling hearts layer (below popup z-index) */
  .hearts-layer{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:99990;overflow:hidden}

  /* toast notifications */
  .toast{
    position:fixed; left:50%; transform:translateX(-50%); bottom:84px; background:rgba(255,255,255,0.96);
    color:#a61757; padding:10px 14px; border-radius:12px; box-shadow:0 10px 30px rgba(200,80,140,0.12);
    max-width:90%; text-align:center; font-size:14px; z-index:9999;
  }

  @media (max-width:380px){
    :root{ --btn-shadow: 0 6px 18px rgba(255,110,170,0.10); }
    .title{font-size:22px}
    #musicBtn{ --size:50px; right:12px; bottom:12px; font-size:20px }
    .photo-wrap{width:96%}
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="card" role="main" aria-label="Birthday card">

    <main class="hero">
      <div class="title">Happiest Birthday Wiffyy<br>This day is for you üéÄ</div>

      <div class="photo-wrap" aria-hidden="false">
        <div class="glow" id="photoGlow" style="--glow-scale:1;--glow-opacity:0.8"></div>
        <img id="mainPhoto" class="photo" src="couple.png" alt="Wiffyy & you">
      </div>

      <div class="card-body">
        <p class="msg">My cute little Wiffyy, you are the sparkle of my life and the softness in my heart. Thank you for every breath of joy. I love you always ‚ù§Ô∏è</p>

        <div class="controls" role="group" aria-label="actions">
          <button class="btn" id="noteBtn" type="button">Give me a love note</button>
          <button class="btn" id="surpriseBtn" type="button">Reveal the Surprise üéÅ</button>
        </div>
      </div>

      <footer>Made with infinite love by your husband ‚ù§Ô∏è</footer>
    </main>
  </div>
</div>

<button id="musicBtn" aria-label="Play music">‚ô™</button>

<audio id="bgAudio" loop preload="auto">
  <source src="audio.mp3" type="audio/mpeg">
  Your browser does not support audio.
</audio>

<div id="popup" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="popup-inner" role="document">
    <img id="popupImg" src="wiffy.png" alt="Wiffyy">
    <div class="popup-text">You are my forever, my cutest blessing, and the most beautiful part of my life. I love you endlessly, Wiffyy! üíû</div>
    <button id="popupClose" class="popup-close" type="button">Close üíó</button>
  </div>
</div>

<div class="hearts-layer" id="heartsLayer" aria-hidden="true"></div>

<script>
/* ---------------- Audio & Glow ---------------- */
const audioEl = document.getElementById('bgAudio');
const musicBtn = document.getElementById('musicBtn');
let audioContext, analyser, sourceNode, dataArray, raf;
let playing=false, touched=false;

function initAnalyser(){
  if(audioContext) return;
  try {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 256;
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    sourceNode = audioContext.createMediaElementSource(audioEl);
    sourceNode.connect(analyser);
    analyser.connect(audioContext.destination);
  } catch(e){console.warn(e);}
}

function pulseGlow(){
  if(!analyser) return;
  const glowEl = document.getElementById('photoGlow');
  (function loop(){
    analyser.getByteTimeDomainData(dataArray);
    let sum=0;
    for(let i=0;i<dataArray.length;i++){
      let v=(dataArray[i]-128)/128;
      sum+=v*v;
    }
    let rms=Math.sqrt(sum/dataArray.length);
    glowEl.style.setProperty('--glow-scale',(1+Math.min(0.9,rms*8)).toFixed(3));
    glowEl.style.setProperty('--glow-opacity',(0.55+Math.min(0.6,rms*6)).toFixed(3));
    raf=requestAnimationFrame(loop);
  })();
}
function stopGlow(){ if(raf) cancelAnimationFrame(raf); }

function startAudio(){
  if(!touched){ touched=true; initAnalyser(); if(audioContext.state==='suspended') audioContext.resume().catch(()=>{}); }
  audioEl.play().then(()=>{
    playing=true; musicBtn.classList.add('playing'); musicBtn.textContent = playing ? '‚ùö‚ùö' : '‚ô™';
  }).catch(e=>console.warn(e));
}
function pauseAudio(){ audioEl.pause(); playing=false; musicBtn.classList.remove('playing'); musicBtn.textContent='‚ô™'; stopGlow(); }

musicBtn.addEventListener('click', e=>{ e.stopPropagation(); if(!touched) startAudio(); else if(playing) pauseAudio(); else startAudio(); });
document.addEventListener('click', function firstTap(){ if(!touched) startAudio(); document.removeEventListener('click', firstTap); }, {passive:true});

/* ---------------- Toast Notes ---------------- */
const notes = [
  "I love the way you laugh ‚Äî it lights up my worst days.",
  "Your kindness is the softest thing I know.",
  "You are my favorite hello and hardest goodbye.",
  "With you, ordinary becomes magical every day.",
  "I fall more in love with you with every sunrise.",
  "Your smile is my favorite sight, every single day.",
  "Being with you feels like home, no matter where we are.",
  "You make my heart dance in ways words can't describe.",
  "Every moment with you is my new favorite memory.",
  "You are the sparkle in my life and the warmth in my soul.",
  "Loving you is the easiest thing I‚Äôve ever done.",
  "You turn my simplest days into unforgettable adventures.",
  "Your love is my favorite song, and I never want it to end.",
  "With you, even silence speaks the sweetest words.",
  "I love you more than all the stars in the night sky."
];
document.getElementById('noteBtn').addEventListener('click', ()=>{ showToast(notes[Math.floor(Math.random()*notes.length)]); spawnHearts(56); randomHeartsBurst();});
function showToast(text){
  const t=document.createElement('div'); t.className='toast'; t.textContent=text;
  document.body.appendChild(t);
  setTimeout(()=> t.style.opacity='0', 4500);
  setTimeout(()=> t.remove(), 5000);
}

/* ---------------- Falling Hearts ---------------- */
const heartsLayer=document.getElementById('heartsLayer');
function spawnHearts(count = 50) {
  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const centerX = vw / 2;
  const centerY = vh / 2;

  for (let i = 0; i < count; i++) {
    const h = document.createElement("div");
    h.textContent = "üíñ";
    h.style.position = "fixed";

    // random size and visibility
    const size = Math.random() * 28 + 16; // 16px to 44px
    h.style.fontSize = size + "px";
    h.style.opacity = 0.8 + Math.random() * 0.2;

    // start exactly at center
    h.style.left = centerX + "px";
    h.style.top = centerY + "px";
    h.style.pointerEvents = "none";

    heartsLayer.appendChild(h);

    // random angle and distance
    const angle = Math.random() * 2 * Math.PI; // 0 to 360¬∞
    const distance = 200 + Math.random() * 200; // how far it flies
    const x = Math.cos(angle) * distance;
    const y = Math.sin(angle) * distance;

    const duration = 1200 + Math.random() * 800; // speed

    h.animate(
      [
        { transform: "translate(0,0) scale(1)", opacity: parseFloat(h.style.opacity) },
        { transform: `translate(${x}px, ${-y}px) scale(${1 + Math.random() * 0.3})`, opacity: 0 }
      ],
      { duration: duration, easing: "ease-out" }
    );

    // remove after animation
    setTimeout(() => h.remove(), duration + 50);
  }
}


/* ---------------- Popup ---------------- */
const popup=document.getElementById('popup'); const popupClose=document.getElementById('popupClose');
document.getElementById('surpriseBtn').addEventListener('click', ()=>{
  popup.style.display='flex'; popup.setAttribute('aria-hidden','false'); spawnHearts(26);
  if(!touched) startAudio(); else if(!playing) startAudio();
  randomHeartsBurst();
});
popupClose.addEventListener('click', ()=>{ popup.style.display='none'; popup.setAttribute('aria-hidden','true'); });

document.addEventListener('keydown', e=>{ if(e.key==='Escape' && popup.style.display==='flex'){ popup.style.display='none'; popup.setAttribute('aria-hidden','true'); } });
popup.addEventListener('touchmove', e=>{ e.stopPropagation(); }, {passive:false});

window.addEventListener('pagehide', ()=>{ if(audioEl) audioEl.pause(); if(raf) cancelAnimationFrame(raf); });
// Remove Celebrate button functionality and trigger hearts randomly
function randomHeartsBurst() {
  // random interval between 1s and 4s
  const interval = 1000 + Math.random() * 3000;
  setTimeout(() => {
    // spawn a random number of hearts (20-50)
    spawnHearts(20 + Math.floor(Math.random() * 30));
    randomHeartsBurst(); // recursively call for next burst
  }, interval);
}

</script>
</body>
</html>
